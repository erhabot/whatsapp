const axios=require("axios"),https=require("https"),{getEncodedSnapApp:getEncodedSnapApp,decodeSnapApp:decodeSnapApp}=require("./utils");module.exports=async function(t){var e,n;if(!/https?:\/\/www\.instagram\.com\/(reel|tv|p)\//i.test(t))throw new Error("Invalid url!!");const o=(await axios("https://165.22.98.17/action.php",{data:{url:encodeURI(t),action:"post"},method:"POST",headers:{"content-type":"application/x-www-form-urlencoded",origin:"https://snapinsta.app",referer:"https://snapinsta.app/","user-agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.93 Safari/537.36"},httpsAgent:new https.Agent({rejectUnauthorized:!1})})).data,a=getEncodedSnapApp(o);if(!Array.isArray(a)||6!==a.length)throw new Error(`Can't parse decode parameters!\n${o}`);const i=decodeSnapApp(...a),p=null===(n=null===(e=null==i?void 0:i.split('("div_download").innerHTML = "'))||void 0===e?void 0:e[1].split('"; parent.document.getElementById("hero-section").remove();')[0].split("</style> <section class=")[1].split('"> ')[1])||void 0===n?void 0:n.split(" </section> ")[0].replace(/\\(\\)?/g,""),r=cheerio.load(p),s=[];if(r(".row.download-box > div.col-md-4").each((function(){let t=r(this).find(".download-items__thumb > img[src]").attr("src");/https?:\/\//i.test(t)||(t="https://snapinsta.app"+t);let e=r(this).find(".download-items__btn > a[href]").attr("href");/https?:\/\//i.test(e||"")||(e=encodeURI("https://snapinsta.app"+e)),e&&s.push({thumbnail:t,url:e})})),!s.length)throw new Error("Can't get video data!");return s};